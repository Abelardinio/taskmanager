version: '3'
services:
  api:
    build:
      context: ./TaskManager.Deployment/docker/api
      dockerfile: ./Dockerfile
    ports:
     - "5000:80"
    volumes:
     - .:/code
    environment:
     - ASPNETCORE_ENVIRONMENT=prod
  messaging:
    build:
      context: ./TaskManager.Deployment/docker/messaging
      dockerfile: ./Dockerfile
    ports:
     - "5001:80"
    volumes:
     - .:/code
    environment:
     - ASPNETCORE_ENVIRONMENT=prod
  apidb:
    build:
      context: ./TaskManager.Deployment
      dockerfile: ./docker/apidb/Dockerfile
  rabbitmq:
    image: "rabbitmq:3-management"
    hostname: "rabbit"
    ports:
      - "15672"
      - "5672"
    labels:
      NAME: "rabbitmq"
    volumes:
      - ./rabbitmq-isolated.conf:/etc/rabbitmq/rabbitmq.config
  nginx:
    build:
      context: ./TaskManager.Deployment/docker/nginx
      dockerfile: ./Dockerfile
    ports:
     - "5002:80"